{% extends "layout.twig" %}

{% block title 'Start Discovering' %}

{% block content %}

    {% if code == null %}
        {{ block('step_1_unfinished') }}
    {% else %}
        {{ block('step_2') }}
    {% endif %}


{% endblock %}

{% block step_1_unfinished %}
    <div class="page-header">
        <h2>Get an access token</h2>
    </div>
    <div class="alert alert-warning">
        Steps A, B and C are not yet complete. Please go <a href="{{ app.url_generator.generate('step1') }}">back</a> to get an Authorization Code.
    </div>
    <ol type="A">
        {{ block('listing1') }}
    </ol>
    <ol type="A" start="4"  class="text-muted">
        {{ block('listing2') }}
    </ol>
    <p>
        See you right back - ready to discover the API. First finish <a href="{{ app.url_generator.generate('step1') }}">Step A,B and C</a>
    </p>
{% endblock %}

{% block step_2 %}

    <div class="alert alert-success">
        Steps A, B and C are complete. You have successful obtained an <code>Authorization Code</code>.
    </div>

    <div class="jumbotron">
        <h1>Discover the API</h1>
        <p>With this access token you can now start making requests to the resource server.</p>
        <p>
            <a class="btn btn-primary btn-lg active center-text"
               role="button" href="{{ app.url_generator.generate('discover') }}">
                Discover
            </a>
        </p>
    </div>

    <ol type="A" class="text-muted">
        {{ block('listing1') }}
    </ol>
    <ol type="A" start="4">
        {{ block('listing2') }}
    </ol>


    <code><pre>{{ token|json_encode(constant('JSON_PRETTY_PRINT')) }}</pre></code>

{% endblock %}

{% block listing1 %}
    <li>
        When you click on one of the scope links, your browser gets send to the authorization server.
    </li>
    <li>
        The authorization server checks validity of client credentials and if user is authenticated
    </li>
    <li>
        If you clicked on the <strong>Yes, I Authorize This Request</strong> button the authorization server sends your browser with
        a query parameter <code>code</code> back to this client application, to step D and E.
    </li>
{% endblock %}

{% block listing2 %}
    <li>
        Behind the scene this client directly requests to exchange the obtained <code>Authorization Code</code> for an <code>access token</code> with the authorization server.
    </li>
    <li>
        The authorization server checked the user and the client and if all requirements are met and sends back the <code>Authorization Code</code> to the client. The client can now request resources from the resource server by presenting the <code>access token</code>.
    </li>
{% endblock %}