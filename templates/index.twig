{% extends "layout.twig" %}

{% block title 'Start Discovering' %}

{% block content %}
    <div class="page-header">
        <h1>Welcome to the EasyBib Demo Client! <small>Discover our hypermedia API</small></h1>
    </div>

    <p>
        This client was created to demonstrate how to access EasyBibs hypermedia api using the <a href="http://tools.ietf.org/html/rfc6749#section-4.1">OAuth2 Authorization Code Grant.</a>
        OAuth2 is not simple to grasp in the beginning so we will guide you through the first steps.
    </p>
    <p>For getting a working client you need three things:</p>
    <ol>
        <li>A <strong>redirectUrl</strong> The redirect URL is the callback URL that EasyBib will return the the user to after successful authentication.</li>
        <li>A <strong>clientID</strong> and a <strong>clientSecret</strong> which you will get when you register your first application on <a href="https://data.easybib.com/application/">https://data.easybib.com/application/</a> where you need to enter your <strong>redirectUrl</strong></li>
    </ol>

    {{ block('step_1') }}

    {% if token == null %}
        {{ block('step_1_unfinished') }}
    {% else %}
        {{ block('step_2') }}
    {% endif %}


    {{ block('readme') }}

{% endblock %}


{% block step_1 %}
    <div class="page-header"><h2>Step 1</h2></div>
    <h3>This is your client application!</h3>
    <p>
        So we can say you registered at EasyBib and are already logged in, registered a client application and this application you are seeing here is your application. Now you want users of your site to allow your application to access their data on EasyBib for them for a usecase.
    </p>
    <h3>Which scope do you need the user to accept?</h3>
    <p>
        To start, we created some scopes to restrict access to the resources.
    </p>

    <div class="row">
        {% for scope, description in scopes %}
            <div class="col-md-3">
                <div class="well well-sm">
                    <p>Click to start granting this client access for {{ description }}</p>
                    <p class="text-center">
                        <a class="btn btn-primary btn-lg active center-text" role="button" href="http://data.easybib.com/oauth/authorize?response_type=code&client_id={{ clientId }}&scope={{ scope }}">{{ scope }}</a>
                    </p>
                </div>
            </div>
        {% endfor %}
    </div>

    <h3>What happens here</h3>
    <ol>
        <li>
            When you click on one of the scope links, the authorization server checks the client credentials and if it is registered and is allowed to access your data. The authorization server also needs you to be logged in to connect your user account on EasyBib to the client.
        </li>
        <li>
            If you clicked on the <strong>Yes, I Authorize This Request</strong> button the authorization server sends your browser with
            a query parameter <code>code</code> back to this client application.
        </li>
    </ol>
{% endblock %}

{% block step_1_unfinished %}
    <div class="page-header"><h2>Step 2</h2></div>
    <p>
        Behind the scene this client then queries the authorization server for an <code>access_token</code> and a <code>refresh_token</code>. If the tokens could be retrieved the browser will be send back here.
    </p>
    <p>
        See you right back - ready for the next step.
    </p>
{% endblock %}

{% block step_2 %}
    <div class="page-header"><h2>Step 2</h2></div>
    <h3>You have successful created an access_token:</h3>
    <code><pre>{{ token|json_encode(constant('JSON_PRETTY_PRINT')) }}</pre></code>
    <p>
        With this access token you can now start making requests to the resource server.
    </p>
    {% set discover_start = (token.scope == 'USER_READ_WRITE' or token.scope == 'USER_READ')?'author':'project' %}
    <div class="row">
        <div class="col-md-12">
            <div class="well well-sm">
                <p>Start discovering EasyBibs hypermedia API</p>
                <p class="text-center">
                    <a class="btn btn-primary btn-lg active center-text"
                       role="button" href="{{ app.url_generator.generate('discover', {rel: discover_start}) }}">
                        Discover
                    </a>
                </p>
            </div>
        </div>
    </div>

{% endblock %}

{% block readme %}
<div class="page-header">
    <h1>The README <small>On how to setup the demo client</small></h1>
</div>
<div class="well">
    {{readme|markdown}}
</div>
{% endblock %}